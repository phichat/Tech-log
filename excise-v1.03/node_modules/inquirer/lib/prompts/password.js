/**
 * `password` type prompt
 */

<<<<<<< HEAD
var util = require("util");
var chalk = require("chalk");
var Base = require("./base");
var observe = require("../utils/events");

function mask(input) {
  input = String(input);
=======
var util = require('util');
var chalk = require('chalk');
var Base = require('./base');
var observe = require('../utils/events');

function mask(input, maskChar) {
  input = String(input);
  maskChar = typeof maskChar === 'string' ? maskChar : '*';
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2
  if (input.length === 0) {
    return '';
  }

<<<<<<< HEAD
  return new Array(input.length + 1).join('*');
=======
  return new Array(input.length + 1).join(maskChar);
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2
}

/**
 * Module exports
 */

module.exports = Prompt;

<<<<<<< HEAD

=======
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2
/**
 * Constructor
 */

function Prompt() {
<<<<<<< HEAD
  return Base.apply( this, arguments );
}
util.inherits( Prompt, Base );

=======
  return Base.apply(this, arguments);
}
util.inherits(Prompt, Base);
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2

/**
 * Start the Inquiry session
 * @param  {Function} cb      Callback when prompt is done
 * @return {this}
 */

<<<<<<< HEAD
Prompt.prototype._run = function( cb ) {
=======
Prompt.prototype._run = function (cb) {
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2
  this.done = cb;

  var events = observe(this.rl);

  // Once user confirm (enter key)
<<<<<<< HEAD
  var submit = events.line.map( this.filterInput.bind(this) );

  var validation = this.handleSubmitEvents( submit );
  validation.success.forEach( this.onEnd.bind(this) );
  validation.error.forEach( this.onError.bind(this) );

  events.keypress.takeUntil( validation.success ).forEach( this.onKeypress.bind(this) );
=======
  var submit = events.line.map(this.filterInput.bind(this));

  var validation = this.handleSubmitEvents(submit);
  validation.success.forEach(this.onEnd.bind(this));
  validation.error.forEach(this.onError.bind(this));

  if (this.opt.mask) {
    events.keypress.takeUntil(validation.success).forEach(this.onKeypress.bind(this));
  }
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2

  // Init
  this.render();

  return this;
};

<<<<<<< HEAD

=======
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2
/**
 * Render the prompt to screen
 * @return {Prompt} self
 */

Prompt.prototype.render = function (error) {
  var message = this.getQuestion();
  var bottomContent = '';

  if (this.status === 'answered') {
<<<<<<< HEAD
    message += chalk.cyan(mask(this.answer));
  } else {
    message += mask(this.rl.line || '');
=======
    message += this.opt.mask ? chalk.cyan(mask(this.answer, this.opt.mask)) : chalk.italic.dim('[hidden]');
  } else if (this.opt.mask) {
    message += mask(this.rl.line || '', this.opt.mask);
  } else {
    message += chalk.italic.dim('[input is hidden] ');
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2
  }

  if (error) {
    bottomContent = '\n' + chalk.red('>> ') + error;
  }

  this.screen.render(message, bottomContent);
};

/**
 * When user press `enter` key
 */

<<<<<<< HEAD
Prompt.prototype.filterInput = function( input ) {
  if ( !input ) {
    return this.opt.default != null ? this.opt.default : "";
=======
Prompt.prototype.filterInput = function (input) {
  if (!input) {
    return this.opt.default == null ? '' : this.opt.default;
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2
  }
  return input;
};

<<<<<<< HEAD
Prompt.prototype.onEnd = function( state ) {
  this.status = "answered";
=======
Prompt.prototype.onEnd = function (state) {
  this.status = 'answered';
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2
  this.answer = state.value;

  // Re-render prompt
  this.render();

  this.screen.done();
<<<<<<< HEAD
  this.done( state.value );
};

Prompt.prototype.onError = function( state ) {
  this.render(state.isValid);
  this.rl.output.unmute();
};

/**
 * When user type
 */

Prompt.prototype.onKeypress = function() {
=======
  this.done(state.value);
};

Prompt.prototype.onError = function (state) {
  this.render(state.isValid);
};

Prompt.prototype.onKeypress = function () {
>>>>>>> 09665636ba9818fc952cd8bfe693d791912356d2
  this.render();
};
